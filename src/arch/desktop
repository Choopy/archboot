#!/bin/bash

_install_DE() {

    # VGA Controller
    _info "Installing VGA Driver"
    install_vga="_${vga_driver}"
    _chroot "pacman --noconfirm -S ${!install_vga}"
    if [[ ${vga_driver} == "bumblebee" ]]; then
        _note "Enabling Bumblebee service"
        _chroot "systemctl enable bumblebeed"
    fi

    # OpenGL & Hardware Video Acceleration
    if [[ ${vga_driver} != "default" ]]; then
        _info "Installing OpenGL & Hardware Video Acceleration"
        install_openGLx64="_${openGL_x64}"
        install_hard="_${hard_video}"
        _chroot "pacman --noconfirm -S ${!install_openGLx64} ${!install_hard}"

        if [[ ! -z ${multilib+x} ]]; then
            install_openGLx86="_${openGL_x86}"
            _chroot "pacman --noconfirm -S ${!install_openGLx86}"
        fi
    fi

    # Desktop Environment
    _info "Installing ${desktop}"
    user_desktop="_${desktop}"
    _chroot "pacman --noconfirm -S ${!user_desktop}"
 }

_DE_settings() {

    # Keyboard layout
    _info "Setting keyboard layout"
    wget ${_url}/conf/00-keyboard.conf
    sed -i -e "s/keymap_code/${keymap_code}/g" 00-keyboard.conf
    mv 00-keyboard.conf /mnt/etc/X11/xorg.conf.d/

    # Groups
    if [[ ! -z ${power+x} ]]; then
        _info "Add ${USER_name} to all groups"
        _chroot "yes | pwck"
        _chroot "yes | grpck"
        group_list=$(cut -d: -f1 /mnt/etc/group)
        for group in ${group_list}; do
            _chroot "gpasswd -a ${USER_name} ${group}"
        done
    fi
}
