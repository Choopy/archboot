#!/bin/bash

_base() {

    # Install Base System
    _info "Installing base system"
    yes '' | pacstrap /mnt base base-devel

    # Setting fstab
    _info "Setting fstab"
    genfstab -U -p /mnt >> /mnt/etc/fstab

    # ROOT password
    _info "Setting root password"
    _chroot "echo 'root:${ROOT_passwd}' | chpasswd"

    # Installing ntp
    _info "Installing ntp"
    _chroot "pacman --noconfirm -S ${_ntp}"

    # Setting TimeZone
    _info "Setting TimeZone"
    _chroot "ln -sf /usr/share/zoneinfo/$region_city /etc/localtime"

    # Setting locale
    _info "Setting and generating locale"
    _chroot "echo '${USER_lang}.UTF-8 UTF-8' >> /etc/locale.gen
    locale-gen
    export LANG=${USER_lang}.UTF-8
    echo 'LANG=${USER_lang}.UTF-8' > /etc/locale.conf"

    # Setting keyboard
    _info "Setting keyboard"
    _chroot "echo 'KEYMAP=${keymap_code}' > /etc/vconsole.conf"

    # Setting Linux
    _info "Setting Linux environment"
    _chroot "mkinitcpio -p linux"

    # Setting pacman.conf
    _info "Setting pacman.conf"
    _chroot "wget ${_url}/conf/pacman.conf
    mv pacman.conf /etc/pacman.conf"

    # Install yaourt
    _info "Installing yaourt"
    _chroot "pacman --noconfirm -Syu ${_yaourtapps}"

    # Install Network
    _info "Installing network"
    _chroot "pacman --noconfirm -S ${_networkapps}
    systemctl enable NetworkManager"

    # Install required packages
    _info "Installing required packages"
    _chroot "pacman --noconfirm -S ${_requiredapps}"

    # Setting Reflector
    _info "Setting reflector.service"
    _chroot "wget ${_url}/conf/reflector.service
    mv reflector.service /etc/systemd/system/reflector.service
    systemctl start reflector.service
    systemctl enable reflector.service"

    # Setting user
    _info "Setting user"
    _chroot "useradd -g users -m -s /bin/bash ${USER_name}
    echo '${USER_name}:${USER_passwd}' | chpasswd
    echo '${USER_name} ALL=(ALL) ALL' >> /etc/sudoers"

    # Setting some Aliases
    _info "Setting some aliases"
    _chroot "wget ${_url}/conf/bashrc
    cat bashrc >> /home/${USER_name}/.bashrc"
}
