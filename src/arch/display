#!/bin/bash

_display_manager() {

    # Install Display Manager
    _info "Installing ${display_man}"
    install_display="_${display_man}"
    _chroot "pacman --noconfirm -S ${!install_display}; "
    _chroot "systemctl enable ${display_man}"

    # Start Session type
    gnome_mate_cinnamon_session=(gnome mate cinnamon)
    kde_xfce_lxde_lxqt_session=(kde xfce lxde lxqt)
    enlightenment_session=(enlightenment)
    budgie_session=(budgie)
    deepin_session=(deepin)

    # Start Session command
    if [[ echo ${gnome_mate_cinnamon_session} | grep -w ${desktop} ]]; then
        session="/usr/bin/${desktop}-session"
    elif [[ echo ${kde_xfce_lxde_lxqt_session} | grep -w ${desktop} ]]; then
        session="/usr/bin/start${desktop}"
    elif [[ echo ${enlightenment_session} | grep -w ${desktop} ]]; then
        session="/usr/bin/enlightenment_start"
    elif [[ echo ${budgie_session} | grep -w ${desktop} ]]; then
        sssion="/usr/bin/budgie-desktop"
    elif[[ echo ${deepin_session} | grep -w ${desktop} ]]; then
        session="/usr/bin/startdde"
    fi

    # GDM
    if [[ ${display_man} == "gdm" ]]; then
        wget ${_url}/conf/xprofile
        mv xprofile /mnt/etc/xprofile

    # LIGHTDM
    elif [[ ${display_man} == "lightdm" ]]; then

        # Select Greeter
        if [[ ${desktop} == "deepin"]]; then
            greeter="deepin"
        elif [[ ${desktop} == "kde"]]; then
            greeter="kde"
        else
            greeter="gtk"
        fi

        default="#greeter-session=example-gtk-gnome"
        session="greeter-session=lightdm-${greeter}-greeter"
        num_on="greeter-setup-script=/usr/bin/numlockx on"
        num_off="#greeter-setup-script="
        sed -i -e "s|${default}|${session}|g" /mnt/etc/lightdm/lightdm.conf
        sed -i -e "s|${num_off}|${num_on}|g" /mnt/etc/lightdm/lightdm.conf

    # SDDM
    elif [[ ${display_man} == "sddm" ]]; then
        _chroot "sddm --example-config > /etc/sddm.conf"
        sed -i -e "s|Session=|Session=${session}|g" /mnt/etc/lxdm/lxdm.conf
        sed -i -e "s/Numlock=none/Numlock=on/g" /mnt/etc/sddm.conf

    # LXDM
    elif [[ ${display_man} == "lxdm" ]]; then
        default="# session=/usr/bin/startlxde"
        sed -i -e "s|${default}|session=${session}|g" /mnt/etc/lxdm/lxdm.conf
        sed -i -e "s/# numlock=0/numlock=1/g" /mnt/etc/lxdm/lxdm.conf
        sed -i -e "s/white=/white=${USER_name}/g" /mnt/etc/lxdm/lxdm.conf
        sed -i -e "s/black=/black=root/g" /mnt/etc/lxdm/lxdm.conf

    # XDM
    elif [[ ${display_man} == "xdm" ]]; then
        echo ${session} > /mnt/home/${USER_name}/.xsession
        chmod 700 /mnt/home/${USER_name}/.xsession
    fi
}
